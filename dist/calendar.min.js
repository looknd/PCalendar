"use strict";function isArray(t){return"[object Array]"===Object.prototype.toString.call(t)}var PCalendar=function(t){this.now=new Date,this.configDate=t.date,this.year=t.date.getFullYear()||this.now.getFullYear(),this.month=t.date.getMonth()+1||this.now.getMonth()+1,this.date=t.date.getDate()||this.now.getDate(),this.daysInMonth=[],this.daysInCalendar=[],this.target=t.target,this.callback=t.callback||function(t){console.log(t)},this.type=t.type||"show",this.format=t.format||null,this.init()};PCalendar.prototype={init:function(){if(this.target.innerHTML="<div class='calendar'><div class='calendar-head'><div class='head-top'><span class='pre-month'>←</span><div class='year'></div>年<div class='month'><select><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='11'>11</option><option value='12'>12</option></select></div>月<span class='next-month'>→</span></div><ul><li>Sun</li><li>Mon</li><li>Tue</li><li>Wed</li><li>Thu</li><li>Fri</li><li>Sat</li></ul></div><div class='calendar-body'><ul></ul></div></div>","hide"==this.type){this.target.innerHTML="<div class='calendar-wrap'><a href='javascript:;' class='calendar-btn'>请选择日期</a><div class='calendar absolute'><div class='calendar-head'><div class='head-top'><span class='pre-month'>←</span><div class='year'></div>年<div class='month'><select><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='11'>11</option><option value='12'>12</option></select></div>月<span class='next-month'>→</span></div><ul><li>Sun</li><li>Mon</li><li>Tue</li><li>Wed</li><li>Thu</li><li>Fri</li><li>Sat</li></ul></div><div class='calendar-body'><ul></ul></div></div>",this.eCalendar=this.target.querySelector(".calendar"),this.eBtn=this.target.querySelector(".calendar-btn"),this.eCalendar.style.display="none",this.eBtn.textContent=this.format(this.configDate);var t=this;this.eBtn.addEventListener("click",function(){"none"==t.eCalendar.style.display?(this.textContent="请选择日期",t.eCalendar.style.display="block"):(this.textContent=t.format(t.configDate),t.eCalendar.style.display="none")},!1)}this.target.querySelector(".pre-month").addEventListener("click",function(){this.switchYearMonth("pre"),this.getCal()}.bind(this),!1),this.target.querySelector(".next-month").addEventListener("click",function(){this.switchYearMonth("next"),this.getCal()}.bind(this),!1),this.target.querySelector(".head-top .month").addEventListener("change",function(t){var e=t.target.value;this.switchYearMonth(null,this.year,e),this.getCal()}.bind(this),!1),this.getCal()},getCal:function(t,e){var i,n;t&&e?(i=this.getMLength(t,e),n=this.getMLength(t,e-1)):(i=this.getMLength(this.year,this.month),n=this.getMLength(this.year,this.month-1)),this.daysInMonth=[];for(var a=1;a<=i;a++)this.daysInMonth.push(a);this.daysInCalendar=[];for(var o=new Date(t||this.year,e-1||this.month-1,1).getDay(),a=0;a<o;a++)this.daysInCalendar.unshift({type:"pre",value:n}),n--;this.daysInCalendar.push(this.daysInMonth);for(var s=42-o-this.daysInMonth.length,a=1;a<=s;a++)this.daysInCalendar.push({type:"next",value:a});this.renderCal()},renderCal:function(){for(var t="",e=0;e<this.daysInCalendar.length;e++){var i=this.daysInCalendar[e];if(isArray(i))for(var n in i)t+=i[n]==this.configDate.getDate()&&this.month==this.configDate.getMonth()+1&&this.year==this.configDate.getFullYear()?"<li class='active'>"+i[n]+"</li>":"<li>"+i[n]+"</li>";else t+="pre"==i.type?"<li class='not-belong' daybelong='pre'>"+i.value+"</li>":"<li class='not-belong' daybelong='next'>"+i.value+"</li>"}this.target.querySelector(".calendar-body>ul").innerHTML=t,this.target.querySelector(".calendar-head .year").innerHTML="<select><option value='"+~~(this.year-3)+"'>"+~~(this.year-3)+"</option><option value='"+~~(this.year-2)+"'>"+~~(this.year-2)+"</option><option value='"+~~(this.year-1)+"'>"+~~(this.year-1)+"</option><option value="+~~this.year+" selected>"+~~this.year+"</option><option value="+~~(this.year+1)+">"+~~(this.year+1)+"</option><option value="+~~(this.year+2)+">"+~~(this.year+2)+"</option><option value="+~~(this.year+3)+">"+~~(this.year+3)+"</option></select>",this.target.querySelector(".year").addEventListener("change",function(t){var e=parseInt(t.target.value);this.switchYearMonth(null,e,this.month),this.getCal()}.bind(this),!1);var a=this.target.querySelectorAll(".month select option");a.forEach(function(t){t.value==this.month&&(t.selected=!0)}.bind(this));var o=this,s=this.target.querySelectorAll(".calendar-body>ul>li");[].forEach.call(s,function(t){t.onclick=function(t){if(t.preventDefault(),"not-belong"==this.className){var e=this.attributes.daybelong.value;"pre"==e?o.switchYearMonth("pre"):"next"==e&&o.switchYearMonth("next")}o.date=~~this.textContent,o.configDate=new Date(o.year,o.month-1,o.date),o.getCal(),"hide"==o.type&&(o.eCalendar.style.display="none",o.eBtn.textContent=o.format(o.configDate)),o.callback(o.configDate,o.format?o.format(o.configDate):null)}})},switchYearMonth:function(t,e,i){t?"pre"==t?1==this.month?(this.year-=1,this.month=12):this.month-=1:"next"==t&&(12==this.month?(this.year+=1,this.month=1):this.month+=1):(this.year=e||this.year,this.month=i||this.month)},getMLength:function(t,e){var i;return i=2==e?t%400==0||t%4==0&&t%100!=0?29:28:1==e||3==e||5==e||7==e||8==e||10==e||12==e?31:30}};